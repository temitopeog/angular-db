{"ast":null,"code":"import { objectAssign } from '../utils/lang/objectAssign';\nimport { validateAttributes, validateEvent, validateEventValue, validateEventProperties, validateKey, validateSplit, validateSplits, validateTrafficType, validateIfNotDestroyed, validateIfOperational } from '../utils/inputValidation';\nimport { startsWith } from '../utils/lang';\nimport { CONTROL, CONTROL_WITH_CONFIG } from '../utils/constants';\nimport { isStorageSync } from '../trackers/impressionObserver/utils';\n/**\n * Decorator that validates the input before actually executing the client methods.\n * We should \"guard\" the client here, while not polluting the \"real\" implementation of those methods.\n */\nexport function clientInputValidationDecorator(settings, client, readinessManager) {\n  var log = settings.log;\n  var isSync = isStorageSync(settings);\n  /**\n   * Avoid repeating this validations code\n   */\n  function validateEvaluationParams(maybeKey, maybeSplitOrSplits, maybeAttributes, methodName) {\n    var multi = startsWith(methodName, 'getTreatments');\n    var key = validateKey(log, maybeKey, methodName);\n    var splitOrSplits = multi ? validateSplits(log, maybeSplitOrSplits, methodName) : validateSplit(log, maybeSplitOrSplits, methodName);\n    var attributes = validateAttributes(log, maybeAttributes, methodName);\n    var isOperational = validateIfNotDestroyed(log, readinessManager, methodName);\n    validateIfOperational(log, readinessManager, methodName);\n    var valid = isOperational && key && splitOrSplits && attributes !== false;\n    return {\n      valid: valid,\n      key: key,\n      splitOrSplits: splitOrSplits,\n      attributes: attributes\n    };\n  }\n  function wrapResult(value) {\n    return isSync ? value : Promise.resolve(value);\n  }\n  function getTreatment(maybeKey, maybeSplit, maybeAttributes) {\n    var params = validateEvaluationParams(maybeKey, maybeSplit, maybeAttributes, 'getTreatment');\n    if (params.valid) {\n      return client.getTreatment(params.key, params.splitOrSplits, params.attributes);\n    } else {\n      return wrapResult(CONTROL);\n    }\n  }\n  function getTreatmentWithConfig(maybeKey, maybeSplit, maybeAttributes) {\n    var params = validateEvaluationParams(maybeKey, maybeSplit, maybeAttributes, 'getTreatmentWithConfig');\n    if (params.valid) {\n      return client.getTreatmentWithConfig(params.key, params.splitOrSplits, params.attributes);\n    } else {\n      return wrapResult(objectAssign({}, CONTROL_WITH_CONFIG));\n    }\n  }\n  function getTreatments(maybeKey, maybeSplits, maybeAttributes) {\n    var params = validateEvaluationParams(maybeKey, maybeSplits, maybeAttributes, 'getTreatments');\n    if (params.valid) {\n      return client.getTreatments(params.key, params.splitOrSplits, params.attributes);\n    } else {\n      var res_1 = {};\n      if (params.splitOrSplits) params.splitOrSplits.forEach(function (split) {\n        return res_1[split] = CONTROL;\n      });\n      return wrapResult(res_1);\n    }\n  }\n  function getTreatmentsWithConfig(maybeKey, maybeSplits, maybeAttributes) {\n    var params = validateEvaluationParams(maybeKey, maybeSplits, maybeAttributes, 'getTreatmentsWithConfig');\n    if (params.valid) {\n      return client.getTreatmentsWithConfig(params.key, params.splitOrSplits, params.attributes);\n    } else {\n      var res_2 = {};\n      if (params.splitOrSplits) params.splitOrSplits.forEach(function (split) {\n        return res_2[split] = objectAssign({}, CONTROL_WITH_CONFIG);\n      });\n      return wrapResult(res_2);\n    }\n  }\n  function track(maybeKey, maybeTT, maybeEvent, maybeEventValue, maybeProperties) {\n    var key = validateKey(log, maybeKey, 'track');\n    var tt = validateTrafficType(log, maybeTT, 'track');\n    var event = validateEvent(log, maybeEvent, 'track');\n    var eventValue = validateEventValue(log, maybeEventValue, 'track');\n    var _a = validateEventProperties(log, maybeProperties, 'track'),\n      properties = _a.properties,\n      size = _a.size;\n    var isOperational = validateIfNotDestroyed(log, readinessManager, 'track');\n    if (isOperational && key && tt && event && eventValue !== false && properties !== false) {\n      // @ts-expect-error\n      return client.track(key, tt, event, eventValue, properties, size);\n    } else {\n      return isSync ? false : Promise.resolve(false);\n    }\n  }\n  return {\n    getTreatment: getTreatment,\n    getTreatmentWithConfig: getTreatmentWithConfig,\n    getTreatments: getTreatments,\n    getTreatmentsWithConfig: getTreatmentsWithConfig,\n    track: track\n  };\n}","map":{"version":3,"names":["objectAssign","validateAttributes","validateEvent","validateEventValue","validateEventProperties","validateKey","validateSplit","validateSplits","validateTrafficType","validateIfNotDestroyed","validateIfOperational","startsWith","CONTROL","CONTROL_WITH_CONFIG","isStorageSync","clientInputValidationDecorator","settings","client","readinessManager","log","isSync","validateEvaluationParams","maybeKey","maybeSplitOrSplits","maybeAttributes","methodName","multi","key","splitOrSplits","attributes","isOperational","valid","wrapResult","value","Promise","resolve","getTreatment","maybeSplit","params","getTreatmentWithConfig","getTreatments","maybeSplits","res_1","forEach","split","getTreatmentsWithConfig","res_2","track","maybeTT","maybeEvent","maybeEventValue","maybeProperties","tt","event","eventValue","_a","properties","size"],"sources":["/Users/temitopeogunrekun/Desktop/angular-db/node_modules/@splitsoftware/splitio-commons/esm/sdkClient/clientInputValidation.js"],"sourcesContent":["import { objectAssign } from '../utils/lang/objectAssign';\nimport { validateAttributes, validateEvent, validateEventValue, validateEventProperties, validateKey, validateSplit, validateSplits, validateTrafficType, validateIfNotDestroyed, validateIfOperational } from '../utils/inputValidation';\nimport { startsWith } from '../utils/lang';\nimport { CONTROL, CONTROL_WITH_CONFIG } from '../utils/constants';\nimport { isStorageSync } from '../trackers/impressionObserver/utils';\n/**\n * Decorator that validates the input before actually executing the client methods.\n * We should \"guard\" the client here, while not polluting the \"real\" implementation of those methods.\n */\nexport function clientInputValidationDecorator(settings, client, readinessManager) {\n    var log = settings.log;\n    var isSync = isStorageSync(settings);\n    /**\n     * Avoid repeating this validations code\n     */\n    function validateEvaluationParams(maybeKey, maybeSplitOrSplits, maybeAttributes, methodName) {\n        var multi = startsWith(methodName, 'getTreatments');\n        var key = validateKey(log, maybeKey, methodName);\n        var splitOrSplits = multi ? validateSplits(log, maybeSplitOrSplits, methodName) : validateSplit(log, maybeSplitOrSplits, methodName);\n        var attributes = validateAttributes(log, maybeAttributes, methodName);\n        var isOperational = validateIfNotDestroyed(log, readinessManager, methodName);\n        validateIfOperational(log, readinessManager, methodName);\n        var valid = isOperational && key && splitOrSplits && attributes !== false;\n        return {\n            valid: valid,\n            key: key,\n            splitOrSplits: splitOrSplits,\n            attributes: attributes\n        };\n    }\n    function wrapResult(value) {\n        return isSync ? value : Promise.resolve(value);\n    }\n    function getTreatment(maybeKey, maybeSplit, maybeAttributes) {\n        var params = validateEvaluationParams(maybeKey, maybeSplit, maybeAttributes, 'getTreatment');\n        if (params.valid) {\n            return client.getTreatment(params.key, params.splitOrSplits, params.attributes);\n        }\n        else {\n            return wrapResult(CONTROL);\n        }\n    }\n    function getTreatmentWithConfig(maybeKey, maybeSplit, maybeAttributes) {\n        var params = validateEvaluationParams(maybeKey, maybeSplit, maybeAttributes, 'getTreatmentWithConfig');\n        if (params.valid) {\n            return client.getTreatmentWithConfig(params.key, params.splitOrSplits, params.attributes);\n        }\n        else {\n            return wrapResult(objectAssign({}, CONTROL_WITH_CONFIG));\n        }\n    }\n    function getTreatments(maybeKey, maybeSplits, maybeAttributes) {\n        var params = validateEvaluationParams(maybeKey, maybeSplits, maybeAttributes, 'getTreatments');\n        if (params.valid) {\n            return client.getTreatments(params.key, params.splitOrSplits, params.attributes);\n        }\n        else {\n            var res_1 = {};\n            if (params.splitOrSplits)\n                params.splitOrSplits.forEach(function (split) { return res_1[split] = CONTROL; });\n            return wrapResult(res_1);\n        }\n    }\n    function getTreatmentsWithConfig(maybeKey, maybeSplits, maybeAttributes) {\n        var params = validateEvaluationParams(maybeKey, maybeSplits, maybeAttributes, 'getTreatmentsWithConfig');\n        if (params.valid) {\n            return client.getTreatmentsWithConfig(params.key, params.splitOrSplits, params.attributes);\n        }\n        else {\n            var res_2 = {};\n            if (params.splitOrSplits)\n                params.splitOrSplits.forEach(function (split) { return res_2[split] = objectAssign({}, CONTROL_WITH_CONFIG); });\n            return wrapResult(res_2);\n        }\n    }\n    function track(maybeKey, maybeTT, maybeEvent, maybeEventValue, maybeProperties) {\n        var key = validateKey(log, maybeKey, 'track');\n        var tt = validateTrafficType(log, maybeTT, 'track');\n        var event = validateEvent(log, maybeEvent, 'track');\n        var eventValue = validateEventValue(log, maybeEventValue, 'track');\n        var _a = validateEventProperties(log, maybeProperties, 'track'), properties = _a.properties, size = _a.size;\n        var isOperational = validateIfNotDestroyed(log, readinessManager, 'track');\n        if (isOperational && key && tt && event && eventValue !== false && properties !== false) { // @ts-expect-error\n            return client.track(key, tt, event, eventValue, properties, size);\n        }\n        else {\n            return isSync ? false : Promise.resolve(false);\n        }\n    }\n    return {\n        getTreatment: getTreatment,\n        getTreatmentWithConfig: getTreatmentWithConfig,\n        getTreatments: getTreatments,\n        getTreatmentsWithConfig: getTreatmentsWithConfig,\n        track: track\n    };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}