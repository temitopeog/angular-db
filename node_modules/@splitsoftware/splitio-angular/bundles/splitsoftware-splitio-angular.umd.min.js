!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@splitsoftware/splitio-browserjs"),require("rxjs")):"function"==typeof define&&define.amd?define("@splitsoftware/splitio-angular",["exports","@angular/core","@splitsoftware/splitio-browserjs","rxjs"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).splitsoftware=t.splitsoftware||{},t.splitsoftware["splitio-angular"]={}),t.ng.core,t.splitioBrowserjs,t.rxjs)}(this,(function(t,e,n,i){"use strict";var r="control",o="init::clientExists",s="init::clientFirst",a={getTreatment:function(){return r},getTreatmentWithConfig:function(){return{treatment:r,config:null}},getTreatments:function(t){var e={};return t.forEach((function(t){var n;e=Object.assign(Object.assign({},e),((n={})[t]=r,n))})),e},getTreatmentsWithConfig:function(t){var e={};return t.forEach((function(t){var n;e=Object.assign(Object.assign({},e),((n={})[t]={treatment:r,config:null},n))})),e},track:function(){return!1}},l={splits:function(){return[]},split:function(){return null},names:function(){return[]}};function u(t){return t.bucketingKey?(t.matchingKey?t.matchingKey:t)+"-"+(t.bucketingKey?t.bucketingKey:t)+"-":t}function c(t,e,n){return p(e)||Array.isArray(e)?{key:t,splitNames:e,attributes:n}:{key:void 0,splitNames:t,attributes:e}}function p(t){return"string"==typeof t||t instanceof String}var f=function(){function t(){this.clientsMap=new Map,this.emittedEvents=new Map,this.isSDKReady=!1}return t.prototype.init=function(t){var e=this;if(this.splitio)return console.log("[ERROR] There is another instance of the SDK."),new i.Observable((function(t){return t.error(o)}));this.config=t,this.splitio=n.SplitFactory(t,(function(t){t.settings.version="angular-ANGULAR_SDK_VERSION_NUMBER"})),this.splitClient=this.splitio.client(),this.splitManager=this.splitio.manager(),this.sdkInitEventObservable();var r=u(this.config.core.key),s=this.splitClient.Event.SDK_READY;return this.splitClient.on(s,(function(){e.emittedEvents.set(r+s,!0),e.isSDKReady=!0})),this.clientsMap.set(r,this.splitClient),this.sdkReady$},t.prototype.initClient=function(t){var e=this.getSDKClient(t);return e?(console.log("[WARN] client for key "+u(t)+" is already initialized."),new i.Observable((function(t){return t.error(o)}))):this.splitio?(e=this.splitio.client(t),this.clientsMap.set(u(t),e),this.toObservable(t,e,e.Event.SDK_READY)):new i.Observable((function(t){return t.error(s)}))},t.prototype.getClientObservable=function(t,e,n){void 0===n&&(n=!0);var r=this.getClient(t);return r===a?new i.Observable((function(t){return t.error(s)})):this.toObservable(t,r,r.Event[e],n)},t.prototype.getClientSDKReady=function(t){return this.getClientObservable(t,"SDK_READY")},t.prototype.getClientSDKReadyTimedOut=function(t){return this.getClientObservable(t,"SDK_READY_TIMED_OUT")},t.prototype.getClientSDKReadyFromCache=function(t){return this.getClientObservable(t,"SDK_READY_FROM_CACHE")},t.prototype.getClientSDKUpdate=function(t){return this.getClientObservable(t,"SDK_UPDATE",!1)},t.prototype.sdkInitEventObservable=function(){var t=this.splitClient,e=this.config.core.key;this.sdkReady$=this.toObservable(e,t,t.Event.SDK_READY),this.sdkReadyTimedOut$=this.toObservable(e,t,t.Event.SDK_READY_TIMED_OUT),this.sdkReadyFromCache$=this.toObservable(e,t,t.Event.SDK_READY_FROM_CACHE),this.sdkUpdate$=this.toObservable(e,t,t.Event.SDK_UPDATE,!1)},t.prototype.ready=function(){return this.getClient().ready()},t.prototype.isInitialized=function(){return!!this.splitio||(console.log("[ERROR] plugin should be initialized"),!1)},t.prototype.getSDKClient=function(t){if(this.isInitialized())return t=t||this.config.core.key,this.clientsMap.get(u(t))},t.prototype.getSDKFactory=function(){if(this.isInitialized())return this.splitio},t.prototype.getClient=function(t){var e=this.getSDKClient(t);return e||(console.log("[ERROR] client"+(t?" for key "+u(t):"")+" should be initialized first."),a)},t.prototype.getTreatment=function(t,e,n){var i=c(t,e,n),r=i.key,o=i.splitNames,s=i.attributes;return this.getClient(r).getTreatment(o,s)},t.prototype.getTreatmentWithConfig=function(t,e,n){var i=c(t,e,n),r=i.key,o=i.splitNames,s=i.attributes;return this.getClient(r).getTreatmentWithConfig(o,s)},t.prototype.getTreatments=function(t,e,n){var i=c(t,e,n),r=i.key,o=i.splitNames,s=i.attributes;return this.getClient(r).getTreatments(o,s)},t.prototype.getTreatmentsWithConfig=function(t,e,n){var i=c(t,e,n),r=i.key,o=i.splitNames,s=i.attributes;return this.getClient(r).getTreatmentsWithConfig(o,s)},t.prototype.track=function(t,e,n,i,r){var o=function(t,e,n,i,r){return p(n)?{key:t,trafficType:e,eventType:n,value:i,properties:r}:{key:void 0,trafficType:t,eventType:e,value:n,properties:i}}(t,e,n,i,r),s=o.key,a=o.trafficType,l=o.eventType,u=o.value,c=o.properties;return this.getClient(s).track(a,l,u,c)},t.prototype.getManager=function(){return this.getSDKClient()?this.splitManager:(console.log("[ERROR] The SDK has not being initialized. Returning default response for method call."),l)},t.prototype.getSplits=function(){return this.getManager().splits()},t.prototype.getSplit=function(t){return this.getManager().split(t)},t.prototype.getSplitNames=function(){return this.getManager().names()},t.prototype.destroy=function(){var t=this,e=u(this.config.core.key);return this.clientsMap.forEach((function(n,i){u(i)!==e&&(n.destroy(),t.clientsMap.delete(u(i)))})),this.clientsMap.delete(e),this.splitio=void 0,i.from(this.splitClient.destroy())},t.prototype.toObservable=function(t,e,n,r){var o=this;void 0===r&&(r=!0);var s=u(t)+n;return r?new i.Observable((function(t){o.emittedEvents.get(s)?Promise.resolve().then((function(){return t.next(n)})):e.once(n,(function(){o.emittedEvents.set(s,!0),t.next(n)}))})):new i.Observable((function(t){e.on(n,(function(){t.next(n)}))}))},t}();f.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new f},token:f,providedIn:"root"}),f.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}];var g=function(){function t(t){this.splitService=t}return t.prototype.canActivate=function(){return this.splitService.isSDKReady},t.prototype.canLoad=function(){return this.splitService.isSDKReady},t.prototype.canActivateChild=function(){return this.splitService.isSDKReady},t}();g.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new g(e.ɵɵinject(f))},token:g,providedIn:"root"}),g.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],g.ctorParameters=function(){return[{type:f}]},Object.defineProperty(t,"DebugLogger",{enumerable:!0,get:function(){return n.DebugLogger}}),Object.defineProperty(t,"ErrorLogger",{enumerable:!0,get:function(){return n.ErrorLogger}}),Object.defineProperty(t,"InLocalStorage",{enumerable:!0,get:function(){return n.InLocalStorage}}),Object.defineProperty(t,"InfoLogger",{enumerable:!0,get:function(){return n.InfoLogger}}),Object.defineProperty(t,"LocalhostFromObject",{enumerable:!0,get:function(){return n.LocalhostFromObject}}),Object.defineProperty(t,"WarnLogger",{enumerable:!0,get:function(){return n.WarnLogger}}),t.SplitService=f,t.SplitioGuard=g,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=splitsoftware-splitio-angular.umd.min.js.map